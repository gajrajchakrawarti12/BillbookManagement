{"ast":null,"code":"\"use client\";\n\nvar _jsxFileName = \"D:\\\\VS studio\\\\web_devlopment\\\\Projects\\\\frontend\\\\src\\\\contexts\\\\AuthContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport Loader from \"../pages/Loader\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(undefined);\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [user, setUser] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  useEffect(() => {\n    const checkAuth = async () => {\n      setIsLoading(true);\n      try {\n        await fetch(`${API_URL}/auth/refresh`, {\n          method: \"POST\",\n          credentials: \"include\",\n          // <-- Correct value here\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({}) // empty body\n        });\n        const res = await axios.get(`${API_URL}/auth/me`, {\n          withCredentials: true\n        });\n        const userData = res.data.user;\n        setUser({\n          ...userData\n        });\n      } catch (error) {\n        setUser(null);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    checkAuth();\n  }, []);\n  const login = async (username, password) => {\n    setIsLoading(true);\n    try {\n      await axios.post(`${API_URL}/auth/login`, {\n        username,\n        password\n      }, {\n        withCredentials: true\n      });\n      const res = await axios.get(`${API_URL}/auth/me`, {\n        withCredentials: true\n      });\n      const userData = res.data.user;\n      setUser({\n        ...userData\n      });\n      return true;\n    } catch (error) {\n      console.error(\"Login failed\", error);\n      return false;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const signup = async (name, username, password, role) => {\n    setIsLoading(true);\n    try {\n      await axios.post(`${API_URL}/auth/register`, {\n        username,\n        password,\n        fullName: name,\n        role: role.toUpperCase()\n      }, {\n        withCredentials: true\n      });\n      return true;\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.log(\"Signup error:\", error);\n      console.error(\"Signup failed:\", (error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || error);\n      return false;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const logout = async () => {\n    try {\n      await axios.post(`${API_URL}/auth/logout`, {}, {\n        withCredentials: true\n      });\n    } catch (error) {\n      console.warn(\"Logout API failed\", error);\n    } finally {\n      setUser(null);\n    }\n  };\n  const checkValidUsername = async username => {\n    try {\n      const responce = await fetch(`${API_URL}/auth/username/${username}`, {\n        method: \"GET\",\n        credentials: \"include\"\n      });\n      if (responce.status == 404) {\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.log(error);\n      return false;\n    }\n  };\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        role: \"status\",\n        \"aria-live\": \"polite\",\n        children: /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this)\n    }, void 0, false);\n  }\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      login,\n      signup,\n      logout,\n      isLoading,\n      checkValidUsername\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 138,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"YajQB7LURzRD+QP5gw0+K2TZIWA=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n_s2(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["_jsxFileName","_s","$RefreshSig$","_s2","React","createContext","useContext","useEffect","useState","axios","Loader","jsxDEV","_jsxDEV","Fragment","_Fragment","AuthContext","undefined","API_URL","process","env","REACT_APP_API_URL","AuthProvider","children","user","setUser","isLoading","setIsLoading","checkAuth","fetch","method","credentials","headers","body","JSON","stringify","res","get","withCredentials","userData","data","error","login","username","password","post","console","signup","name","role","fullName","toUpperCase","_error$response","_error$response$data","log","response","message","logout","warn","checkValidUsername","responce","status","fileName","lineNumber","columnNumber","Provider","value","_c","useAuth","context","Error","$RefreshReg$"],"sources":["D:/VS studio/web_devlopment/Projects/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport type { User } from \"../interfaces/User\";\nimport type { AuthContextType } from \"../interfaces/AuthContextType\";\nimport Loader from \"../pages/Loader\";\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true); \n\n  useEffect(() => {\n    const checkAuth = async () => {\n      setIsLoading(true)\n      try {\n          await fetch(`${API_URL}/auth/refresh`, {\n          method: \"POST\",\n          credentials: \"include\", // <-- Correct value here\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({}), // empty body\n        });\n        const res = await axios.get(`${API_URL}/auth/me`, {\n          withCredentials: true,\n        });\n        const userData = res.data.user;\n        setUser({ ...userData });\n      } catch (error) {\n        setUser(null);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    checkAuth();\n  }, []);\n\n  const login = async (\n    username: string,\n    password: string\n  ): Promise<boolean> => {\n    setIsLoading(true);\n    try {\n      await axios.post(\n        `${API_URL}/auth/login`,\n        { username, password },\n        { withCredentials: true }\n      );\n\n      const res = await axios.get(`${API_URL}/auth/me`, {\n        withCredentials: true,\n      });\n      const userData = res.data.user;\n      setUser({ ...userData });\n      return true;\n    } catch (error) {\n      console.error(\"Login failed\", error);\n      return false;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const signup = async (\n    name: string,\n    username: string,\n    password: string,\n    role: string\n  ): Promise<boolean> => {\n    setIsLoading(true);\n    try {\n      await axios.post(\n        `${API_URL}/auth/register`,\n        {\n          username,\n          password,\n          fullName: name,\n          role: role.toUpperCase(),\n        },\n        { withCredentials: true }\n      );\n      return true;\n    } catch (error: any) {\n      console.log(\"Signup error:\", error);\n      console.error(\n        \"Signup failed:\",\n        error?.response?.data?.message || error.message || error\n      );\n      return false;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await axios.post(`${API_URL}/auth/logout`, {}, { withCredentials: true });\n    } catch (error) {\n      console.warn(\"Logout API failed\", error);\n    } finally {\n      setUser(null);\n    }\n  };\n\n  const checkValidUsername = async (username: string) => {\n    try {\n      const responce = await fetch(`${API_URL}/auth/username/${username}`,{\n        method: \"GET\",\n        credentials:\"include\"\n      });\n      if (responce.status == 404) {\n        return true\n      }\n      return false;\n    } catch (error) {\n      console.log(error);\n      return false;\n    }\n  }\n\n  \n  if (isLoading) {\n    return (\n      <>\n        <div role=\"status\" aria-live=\"polite\">\n          <Loader />\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <AuthContext.Provider value={{ user, login, signup, logout, isLoading, checkValidUsername }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}